<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Webpack Config Assign by DSchau</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Webpack Config Assign</h1>
      <h2 class="project-tagline">A utility to merge webpack config(s) (typically separated out by environment)</h2>
      <a href="https://github.com/DSchau/webpack-config-assign" class="btn">View on GitHub</a>
      <a href="https://github.com/DSchau/webpack-config-assign/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/DSchau/webpack-config-assign/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h3>
<a id="webpack-config-assign" class="anchor" href="#webpack-config-assign" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>webpack-config-assign</h3>

<h4>
<a id="what-it-is" class="anchor" href="#what-it-is" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What it is</h4>

<p>A utility to merge separate webpack configs (e.g. <code>webpack.config.prod.js</code>, <code>webpack.config.development.js</code>, etc.) in a smarter way than a simple merge or assign.</p>

<h4>
<a id="what-it-does" class="anchor" href="#what-it-does" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What it does</h4>

<p>It looks at each configuration key passed in (e.g. <code>plugins</code>, <code>module</code>, <code>entry</code>, etc.) and if it can merge it intelligently, the utility attempts to do so. For instance, consider the following scenarios:</p>

<ul>
<li>A development config that inlines CSS into the bundle</li>
<li>A production config that extracts the CSS out into a separate plugin</li>
<li>Uglification plugin(s) and other production enhancements only applied in production</li>
</ul>

<p>This plugin is able to intelligently merge each of the above, in essence, in concatenates plugins, and intelligently merges loaders when the <code>test</code> matches.</p>

<h3>
<a id="how-to-use" class="anchor" href="#how-to-use" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How to use</h3>

<p>The utility can be seamlessly integrated into an existing workflow, particularly one that has already been segmented out into environment configs. However, if using a monolithic <code>webpack.config.js</code> with a bunch of environment checks, then some work will need to be done to separate these out into their respective environments/phases.</p>

<p>Consider the following "base" config (configuration that will be shared between dev, test, and/or production). I like to name it <code>webpack.config.base.js</code>, but it can just as easily be inlined into <code>webpack.config.js</code>:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">webpack</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>webpack<span class="pl-pds">'</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">HtmlWebpackPlugin</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>html-webpack-plugin<span class="pl-pds">'</span></span>);

<span class="pl-k">const</span> <span class="pl-c1">path</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>);
<span class="pl-k">const</span> <span class="pl-c1">pkg</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-smi">path</span>.<span class="pl-en">resolve</span>(<span class="pl-s"><span class="pl-pds">'</span>./package.json<span class="pl-pds">'</span></span>));

<span class="pl-c1">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> {
  devtool<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>source-map<span class="pl-pds">'</span></span>,
  entry<span class="pl-k">:</span> {
    [<span class="pl-smi">pkg</span>.<span class="pl-c1">name</span>]<span class="pl-k">:</span> [
      <span class="pl-s"><span class="pl-pds">'</span>./src/index<span class="pl-pds">'</span></span>
    ],
    vendor<span class="pl-k">:</span> <span class="pl-c1">Object</span>.<span class="pl-c1">keys</span>(<span class="pl-smi">pkg</span>.<span class="pl-smi">dependencies</span>)
      .<span class="pl-en">filter</span>((<span class="pl-smi">dep</span>) <span class="pl-k">=&gt;</span> {
        <span class="pl-k">return</span> [<span class="pl-s"><span class="pl-pds">'</span>normalize.css<span class="pl-pds">'</span></span>].<span class="pl-c1">indexOf</span>(dep) <span class="pl-k">===</span> <span class="pl-k">-</span><span class="pl-c1">1</span>;
      })
  },
  output<span class="pl-k">:</span> {
    filename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>[name].js<span class="pl-pds">'</span></span>,
    path<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>./dist/<span class="pl-pds">'</span></span>)
  },
  module<span class="pl-k">:</span> {
    rules<span class="pl-k">:</span> [
      {
        test<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-cce">\.</span>js(x)<span class="pl-k">?</span><span class="pl-k">$</span><span class="pl-pds">/</span></span>,
        include<span class="pl-k">:</span> [<span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src<span class="pl-pds">'</span></span>)],
        use<span class="pl-k">:</span> [
          <span class="pl-s"><span class="pl-pds">'</span>react-hot-loader/webpack<span class="pl-pds">'</span></span>,
          <span class="pl-s"><span class="pl-pds">'</span>babel-loader<span class="pl-pds">'</span></span>
        ]
      },
      {
        test<span class="pl-k">:</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-cce">\.</span>css<span class="pl-k">$</span><span class="pl-pds">/</span></span>,
        use<span class="pl-k">:</span> [
          <span class="pl-s"><span class="pl-pds">'</span>style-loader<span class="pl-pds">'</span></span>,
          {
            loader<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>css-loader<span class="pl-pds">'</span></span>,
            options<span class="pl-k">:</span> {
              importLoaders<span class="pl-k">:</span> <span class="pl-c1">1</span>,
              modules<span class="pl-k">:</span> <span class="pl-c1">true</span>
            }
          },
          <span class="pl-s"><span class="pl-pds">'</span>postcss-loader<span class="pl-pds">'</span></span>
        ]
      }
    ]
  },
  plugins<span class="pl-k">:</span> [
    <span class="pl-k">new</span> <span class="pl-en">HtmlWebpackPlugin</span>({
      filename<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>dist<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>index.html<span class="pl-pds">'</span></span>),
      inject<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>body<span class="pl-pds">'</span></span>,
      template<span class="pl-k">:</span> <span class="pl-smi">path</span>.<span class="pl-c1">join</span>(<span class="pl-c1">__dirname</span>, <span class="pl-s"><span class="pl-pds">'</span>src<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>index.html<span class="pl-pds">'</span></span>)
    }),
    <span class="pl-k">new</span> <span class="pl-en">webpack.optimize.CommonsChunkPlugin</span>({
      name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>vendor<span class="pl-pds">'</span></span>,
      minChunks<span class="pl-k">:</span> <span class="pl-c1">Infinity</span>
    }),
    <span class="pl-k">new</span> <span class="pl-en">webpack.LoaderOptionsPlugin</span>({
      options<span class="pl-k">:</span> {
        context<span class="pl-k">:</span> <span class="pl-c1">__dirname</span>,
        postcss<span class="pl-k">:</span> [
          <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>postcss-nested<span class="pl-pds">'</span></span>),
          <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>postcss-cssnext<span class="pl-pds">'</span></span>)({
            browsers<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>ie &gt;= 9<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>last 2 versions<span class="pl-pds">'</span></span>]
          })
        ]
      }
    }),
    <span class="pl-k">new</span> <span class="pl-en">webpack.NoErrorsPlugin</span>(),
    <span class="pl-k">new</span> <span class="pl-en">webpack.NamedModulesPlugin</span>(),
    <span class="pl-k">new</span> <span class="pl-en">webpack.DefinePlugin</span>({
      <span class="pl-s"><span class="pl-pds">'</span>process.env<span class="pl-pds">'</span></span><span class="pl-k">:</span> { 
         <span class="pl-c1">NODE_ENV</span><span class="pl-k">:</span> <span class="pl-c1">JSON</span>.<span class="pl-en">stringify</span>(<span class="pl-c1">process</span>.<span class="pl-smi">env</span>.<span class="pl-c1">NODE_ENV</span>) 
       }
    })
  ]
};</pre></div>

<p>the above is a fairly typical config, and this could be dropped into <code>webpack.config.js</code> quite easily. However, what if we want super speedy reload times, webpack-dev-server, and so on and so forth in development. Well, let's create a <code>webpack.config.development.js</code>, like so:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">DashboardPlugin</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>webpack-dashboard/plugin<span class="pl-pds">'</span></span>);

<span class="pl-c1">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> {
  devtool<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>eval<span class="pl-pds">'</span></span>,
  entry<span class="pl-k">:</span> {
    [<span class="pl-smi">pkg</span>.<span class="pl-c1">name</span>]<span class="pl-k">:</span> [
      <span class="pl-s"><span class="pl-pds">'</span>webpack-dev-server/client?http://localhost:3000<span class="pl-pds">'</span></span>,
      <span class="pl-s"><span class="pl-pds">'</span>webpack/hot/only-dev-server<span class="pl-pds">'</span></span>,
      <span class="pl-s"><span class="pl-pds">'</span>react-hot-loader/patch<span class="pl-pds">'</span></span>,
      <span class="pl-s"><span class="pl-pds">'</span>./src/index<span class="pl-pds">'</span></span>
    ]
  },
  plugins<span class="pl-k">:</span> [
    <span class="pl-k">new</span> <span class="pl-en">DashboardPlugin</span>()
  ]
};</pre></div>

<p>now we're cooking. We are using the excellent <code>webpack-dashboard</code> plugin, and we're also doing some nice webpack hot reloading with the webpack dev server. Now, let's get to merging those configurations</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">webpackConfigAssign</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>webpack-config-assign<span class="pl-pds">'</span></span>);

<span class="pl-k">const</span> <span class="pl-c1">devConfig</span> <span class="pl-k">=</span> <span class="pl-c1">process</span>.<span class="pl-smi">env</span>.<span class="pl-c1">NODE_ENV</span> <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>development<span class="pl-pds">'</span></span> <span class="pl-k">?</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>./webpack.config.development<span class="pl-pds">'</span></span>) <span class="pl-k">:</span> {};

<span class="pl-c1">module</span>.<span class="pl-smi">exports</span> <span class="pl-k">=</span> <span class="pl-en">webpackConfigAssign</span>(<span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>./webpack.config.base<span class="pl-pds">'</span></span>), devConfig);</pre></div>

<p>and like that, we're done. Easy as pie! Let's wrap up what specifically happened:</p>

<ul>
<li>Our entry for development will use the webpack-dev-server

<ul>
<li>Because the keys match, the <code>entry[pkg.name]</code> will be overwritten by the development config, rather than merged</li>
</ul>
</li>
<li>Our plugins for development are merged/concatenated with our base config</li>
<li>We have super speedy hot reloads and instant feedback, and an ultra slick dashboard, with little effort and manual intervention</li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/DSchau/webpack-config-assign">Webpack Config Assign</a> is maintained by <a href="https://github.com/DSchau">DSchau</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
